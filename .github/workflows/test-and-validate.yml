jobs:
  test:
    runs-on: ubuntu-latest
    timeout-minutes: 15
    # MOVE ENV HERE: This makes variables available to ALL steps in this job
    env:
      ALPACA_API_KEY: ${{ secrets.ALPACA_API_KEY }}
      ALPACA_SECRET_KEY: ${{ secrets.ALPACA_SECRET_KEY }}
      ALPACA_BASE_URL: ${{ secrets.ALPACA_BASE_URL || 'https://paper-api.alpaca.markets' }}

    steps:
      - name: ðŸ“¥ Checkout
        uses: actions/checkout@v4

      # ... (Setup and Install steps) ...

      - name: ðŸ§ª Run Unit Tests
        # You can now remove the env block from here
        run: |
          echo "Running test suite..."
          python test_bot.py

      - name: ðŸŽ¯ Validate Configuration
        # This will now work because the Job-level env is inherited!
        run: |
          python -c "
          import os
          from config import settings
          # ... rest of your script ...
          "
